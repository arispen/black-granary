{{ define "diplomacy_inner" }}
<h3 class="heading-with-icon"><span class="icon icon-tint-teal" style="--icon-src: url('/assets/icons/ffffff/transparent/1x1/delapouite/shaking-hands.png');" aria-hidden="true"></span>Diplomacy</h3>
{{ if .HasOtherPlayers }}
  <form class="diplomacy-form" hx-post="/message" hx-target="#dashboard" hx-swap="innerHTML">
    <select name="target_id" aria-label="Diplomacy target">
      {{ range .PlayerOptions }}<option value="{{ .ID }}" {{ if eq $.MessageDraftTargetID .ID }}selected{{ end }}>{{ .Name }}</option>{{ end }}
    </select>
    <input type="text" name="subject" value="{{ .MessageDraftSubject }}" placeholder="Subject" maxlength="80" autocomplete="off">
    <textarea name="body" rows="3" placeholder="Message" maxlength="260">{{ .MessageDraftBody }}</textarea>
    <div class="muted" style="margin-top:6px;">
      <label><input type="checkbox" name="sealed" value="1" {{ if .MessageDraftSealed }}checked{{ end }} {{ if .SealMessageDisabled }}disabled{{ end }}> Seal missive ({{ .SealMessageCost }}g)</label>
      {{ if .SealMessageDisabledNote }}<span class="muted" style="margin-left:6px;">{{ .SealMessageDisabledNote }}</span>{{ end }}
    </div>
    <button type="submit">Send Message</button>
  </form>
{{ else }}
  <div class="muted">No other players to contact.</div>
{{ end }}
<div class="muted" style="margin-top:8px;">Recent missives</div>
<div class="events" style="max-height:200px;">
  {{ range .Messages }}
    <div class="event-line">
      <div class="event-meta">{{ .At }} · {{ if eq .Direction "Sent" }}to {{ .ToName }}{{ else }}from {{ .FromName }}{{ end }} · {{ .Direction }}{{ if .Sealed }} · sealed{{ end }}</div>
      <div><strong>{{ .Subject }}</strong></div>
      <div>{{ .Body }}</div>
    </div>
  {{ else }}
    <div class="muted">No messages delivered yet.</div>
  {{ end }}
</div>
{{ end }}

{{ define "diplomacy" }}
<div id="diplomacy" class="card">
  {{ template "diplomacy_inner" . }}
</div>
{{ end }}

{{ define "diplomacy_oob" }}
<div id="diplomacy" hx-swap-oob="innerHTML" class="card">
  {{ template "diplomacy_inner" . }}
</div>
{{ end }}
