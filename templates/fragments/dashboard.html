{{ define "dashboard" }}
<div class="card">
  <h2>Today's Situation</h2>
  <div class="situation">{{ .Situation }}</div>
  <div class="status-grid">
    <div class="card"><strong>Grain</strong><br>{{ .World.GrainTier }}</div>
    <div class="card"><strong>Unrest</strong><br>{{ .World.UnrestTier }}</div>
    <div class="card"><strong>You</strong><br>{{ .Player.Gold }}g · {{ .PlayerTitle }}</div>
  </div>
</div>
<div class="card">
  <h3>Your Standing in Black Granary</h3>
  <div class="status-grid">
    <div class="card"><strong>Reputation</strong><br>{{ .Standing.ReputationValue }} · {{ .Standing.ReputationLabel }}</div>
    <div class="card"><strong>Heat</strong><br>{{ .Standing.HeatValue }} · {{ .Standing.HeatLabel }}</div>
    <div class="card"><strong>Wealth</strong><br>{{ .Standing.WealthGold }}g</div>
    <div class="card"><strong>Impact</strong><br>Today {{ .Standing.CompletedToday }}</div>
    <div class="card"><strong>Impact</strong><br>Lifetime {{ .Standing.CompletedTotal }}</div>
    <div class="card"><strong>Rumors</strong><br>{{ .Standing.Rumors }}</div>
  </div>
</div>
<div class="card" style="margin-top:12px;">
  <h3>Institutions and Offices</h3>
  <div class="muted">Tax: {{ .Policies.TaxRatePct }}% · Permit: {{ if .Policies.PermitRequiredHighRisk }}Required{{ else }}Open{{ end }} · Embargo: {{ .Policies.SmugglingEmbargoTicks }} ticks</div>
  <div class="contracts" style="margin-top:8px;">
    {{ range .Seats }}
      <div class="contract">
        <div><strong>{{ .Name }}</strong> <span class="pill">{{ .InstitutionName }}</span></div>
        <div class="meta">
          <span>Holder: {{ .HolderName }}</span>
          {{ if .IsElectionOpen }}
            <span>Election open: {{ .ElectionWindowTicks }} ticks left</span>
          {{ else }}
            <span>Tenure: {{ .TenureTicksLeft }} ticks left</span>
          {{ end }}
        </div>
        <div class="actions">
          {{ if .CanCampaign }}
            <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML" hx-disabled-elt="button">
              <input type="hidden" name="action" value="campaign_seat">
              <input type="hidden" name="contract_id" value="{{ .ID }}">
              <button type="submit">Campaign</button>
            </form>
          {{ end }}
          {{ if .CanChallenge }}
            <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML" hx-disabled-elt="button">
              <input type="hidden" name="action" value="challenge_seat">
              <input type="hidden" name="contract_id" value="{{ .ID }}">
              <button class="secondary" type="submit">Challenge</button>
            </form>
          {{ end }}
          {{ if .CanToggleTaxHigh }}
            <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML" hx-disabled-elt="button">
              <input type="hidden" name="action" value="set_tax_high">
              <button class="secondary" type="submit">Tax 20%</button>
            </form>
          {{ end }}
          {{ if .CanToggleTaxLow }}
            <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML" hx-disabled-elt="button">
              <input type="hidden" name="action" value="set_tax_low">
              <button class="secondary" type="submit">Tax 5%</button>
            </form>
          {{ end }}
          {{ if .CanTogglePermit }}
            <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML" hx-disabled-elt="button">
              <input type="hidden" name="action" value="toggle_permit">
              <button class="secondary" type="submit">Toggle Permit</button>
            </form>
          {{ end }}
          {{ if .CanToggleEmbargo }}
            <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML" hx-disabled-elt="button">
              <input type="hidden" name="action" value="toggle_embargo">
              <button class="secondary" type="submit">Toggle Embargo</button>
            </form>
          {{ end }}
        </div>
      </div>
    {{ end }}
  </div>
</div>
<div class="card" style="margin-top:12px;">
  <h3>Contracts</h3>
  <div class="muted">Accepted by you: {{ .AcceptedCount }} · Showing: {{ .VisibleContractN }} / {{ .TotalContractN }}</div>
  <div class="contracts" style="margin-top:8px;">
    {{ range .Contracts }}
      <div class="contract {{ .UrgencyClass }}">
        <div><strong>{{ .Type }}</strong> <span class="pill">{{ .Status }}</span></div>
        <div class="meta">
          <span>Deadline: {{ .DeadlineTicks }} ticks</span>
          <span>Taken by: {{ .OwnerName }}</span>
          {{ if ne .OwnerName "-" }}<span>Stance: {{ .Stance }}</span>{{ end }}
        </div>
        <div class="actions">
          {{ if .CanAccept }}
            <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML" hx-disabled-elt="button,select">
              <input type="hidden" name="action" value="accept">
              <input type="hidden" name="contract_id" value="{{ .ID }}">
              <select name="stance" aria-label="Choose stance">
                <option value="Careful" selected>Careful</option>
                <option value="Fast">Fast</option>
                <option value="Quiet">Quiet</option>
              </select>
              <button type="submit">Accept</button>
            </form>
          {{ end }}
          {{ if .CanIgnore }}
            <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML" hx-disabled-elt="button">
              <input type="hidden" name="action" value="ignore">
              <input type="hidden" name="contract_id" value="{{ .ID }}">
              <button class="secondary" type="submit">Ignore</button>
            </form>
          {{ end }}
          {{ if .CanAbandon }}
            <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML" hx-disabled-elt="button">
              <input type="hidden" name="action" value="abandon">
              <input type="hidden" name="contract_id" value="{{ .ID }}">
              <button class="secondary" type="submit">Abandon</button>
            </form>
          {{ end }}
          {{ if .CanDeliver }}
            <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML" hx-disabled-elt="button">
              <input type="hidden" name="action" value="deliver">
              <input type="hidden" name="contract_id" value="{{ .ID }}">
              <button class="warn" type="submit">{{ .DeliverLabel }}</button>
            </form>
          {{ end }}
        </div>
      </div>
    {{ else }}
      <div class="muted">No contracts on the board.</div>
    {{ end }}
  </div>
  <div class="actions" style="margin-top:10px;">
    <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML">
      <input type="hidden" name="action" value="investigate">
      <button type="submit">Investigate</button>
    </form>
    <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML">
      <input type="hidden" name="action" value="petition_institution">
      <button class="secondary" type="submit">Petition</button>
    </form>
    <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML">
      <input type="hidden" name="action" value="bribe_official">
      <input type="hidden" name="amount" value="3">
      <button class="secondary" type="submit">Bribe</button>
    </form>
    <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML">
      <input type="hidden" name="action" value="broker_deal">
      <button class="secondary" type="submit">Broker Deal</button>
    </form>
    <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML">
      <input type="hidden" name="action" value="invoke_rite">
      <button class="secondary" type="submit">Invoke Rite</button>
    </form>
  </div>
</div>
{{ end }}
