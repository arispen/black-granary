{{ define "intel_inner" }}
<h3>Intel</h3>
<div class="muted" style="margin-bottom:6px;">High impact actions remaining: {{ .HighImpactRemaining }} / {{ .HighImpactCap }}</div>
{{ if .Traveling }}
  <div class="muted" style="margin-bottom:6px;">Travel in progress: intel actions are paused.</div>
{{ end }}
{{ if gt .World.WardNetworkTicks 0 }}
  <div class="muted" style="margin-bottom:6px;">Ward network active: scrying dampened for {{ .World.WardNetworkTicks }} ticks.</div>
{{ end }}
{{ if .HasOtherPlayers }}
  <form class="actions" hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML" style="margin-top:0;">
    <input type="hidden" name="action" value="seed_rumor">
    <select name="target_id" aria-label="Rumor target" {{ if $.Traveling }}disabled{{ end }}>
      {{ range .PlayerOptions }}<option value="{{ .ID }}">{{ .Name }}</option>{{ end }}
    </select>
    <input id="claim-input" name="claim" placeholder="Claim" maxlength="120" style="min-width:180px;" {{ if $.Traveling }}disabled{{ end }}>
    <button type="submit" {{ if $.Traveling }}disabled{{ end }}>Seed Rumor</button>
  </form>
  <form class="actions" hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML">
    <input type="hidden" name="action" value="investigate_target">
    <select name="target_id" aria-label="Investigate target" {{ if $.Traveling }}disabled{{ end }}>
      {{ range .PlayerOptions }}<option value="{{ .ID }}">{{ .Name }}</option>{{ end }}
    </select>
    <button class="secondary" type="submit" {{ if or .InvestigateDisabled $.Traveling }}disabled{{ end }}>{{ .InvestigateLabel }}</button>
  </form>
  <form class="actions" hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML">
    <input type="hidden" name="action" value="publish_evidence">
    <select name="target_id" aria-label="Publish target" {{ if $.Traveling }}disabled{{ end }}>
      {{ range .PlayerOptions }}<option value="{{ .ID }}">{{ .Name }}</option>{{ end }}
    </select>
    <button class="secondary" type="submit" {{ if or (eq .HighImpactRemaining 0) $.Traveling }}disabled{{ end }}>Publish Evidence</button>
  </form>
  {{ if .ForgeEvidenceReason }}
    <div class="muted" style="margin-top:4px;">{{ .ForgeEvidenceReason }}</div>
  {{ end }}
  <form class="actions" hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML">
    <input type="hidden" name="action" value="forge_evidence">
    <select name="target_id" aria-label="Forge target" {{ if $.Traveling }}disabled{{ end }}>
      {{ range .PlayerOptions }}<option value="{{ .ID }}">{{ .Name }}</option>{{ end }}
    </select>
    <button class="warn" type="submit" {{ if .ForgeEvidenceDisabled }}disabled{{ end }}>Forge Evidence ({{ .ForgeEvidenceCost }}g)</button>
  </form>
  <form class="actions" hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML">
    <input type="hidden" name="action" value="scry_target">
    <select name="target_id" aria-label="Scry target" {{ if $.Traveling }}disabled{{ end }}>
      {{ range .PlayerOptions }}<option value="{{ .ID }}">{{ .Name }}</option>{{ end }}
    </select>
    <button class="secondary" type="submit" {{ if or (eq .HighImpactRemaining 0) $.Traveling }}disabled{{ end }}>Scry Target</button>
  </form>
  <form class="actions" hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML">
    <input type="hidden" name="action" value="intercept_courier">
    <select name="target_id" aria-label="Intercept target" {{ if $.Traveling }}disabled{{ end }}>
      {{ range .PlayerOptions }}<option value="{{ .ID }}">{{ .Name }}</option>{{ end }}
    </select>
    <button class="secondary" type="submit" {{ if or (eq .HighImpactRemaining 0) $.Traveling }}disabled{{ end }}>Intercept Courier</button>
  </form>
  <form class="actions" hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML">
    <input type="hidden" name="action" value="counter_narrative">
    <select name="target_id" aria-label="Counter target" {{ if $.Traveling }}disabled{{ end }}>
      {{ range .PlayerOptions }}<option value="{{ .ID }}">{{ .Name }}</option>{{ end }}
    </select>
    <button class="secondary" type="submit" {{ if $.Traveling }}disabled{{ end }}>Counter Narrative</button>
  </form>
  <form class="actions" hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML">
    <input type="hidden" name="action" value="threaten_exposure">
    <select name="target_id" aria-label="Threaten target" {{ if $.Traveling }}disabled{{ end }}>
      {{ range .PlayerOptions }}<option value="{{ .ID }}">{{ .Name }}</option>{{ end }}
    </select>
    <button class="warn" type="submit" {{ if or (eq .HighImpactRemaining 0) $.Traveling }}disabled{{ end }}>Threaten Exposure</button>
  </form>
  <form class="actions" hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML">
    <input type="hidden" name="action" value="accuse_heresy">
    <select name="target_id" aria-label="Accuse target" {{ if $.Traveling }}disabled{{ end }}>
      {{ range .PlayerOptions }}<option value="{{ .ID }}">{{ .Name }}</option>{{ end }}
    </select>
    <button class="warn" type="submit" {{ if or (eq .HighImpactRemaining 0) $.Traveling }}disabled{{ end }}>Accuse Heresy</button>
  </form>
{{ else }}
  <div class="muted" style="margin-bottom:8px;">No other players online for intel actions.</div>
{{ end }}
<div class="muted" style="margin-top:8px;">Rumors</div>
<div class="events" style="max-height:160px;">
  {{ range .Rumors }}
    <div class="event-line">
      <div class="event-meta">{{ .SourceName }} -> {{ .TargetName }} · cred {{ .Credibility }} · spread {{ .Spread }} · decay {{ .Decay }}</div>
      <div>{{ .Claim }}</div>
    </div>
  {{ else }}<div class="muted">No active rumors.</div>{{ end }}
</div>
<div class="muted" style="margin-top:8px;">Your Evidence</div>
<div class="events" style="max-height:140px;">
  {{ range .Evidence }}
    <div class="event-line"><div class="event-meta">{{ .TargetName }} · {{ .Topic }} · str {{ .Strength }} · {{ .SourceNote }} · expires {{ .ExpiryIn }}t</div></div>
  {{ else }}<div class="muted">No evidence held.</div>{{ end }}
</div>
<div class="muted" style="margin-top:8px;">Scrying Reports</div>
<div class="events" style="max-height:140px;">
  {{ range .ScryReports }}
    <div class="event-line">
      <div class="event-meta">{{ .TargetName }} · {{ .LocationName }}{{ if .TravelNote }} · {{ .TravelNote }}{{ end }} · expires {{ .ExpiryIn }}</div>
      <div>Rep {{ .Rep }} · Heat {{ .Heat }} · Gold {{ .Gold }} · Grain {{ .Grain }}</div>
    </div>
  {{ else }}<div class="muted">No active scrying reports.</div>{{ end }}
</div>
<div class="muted" style="margin-top:8px;">Intercepted Missives</div>
<div class="events" style="max-height:140px;">
  {{ range .Intercepts }}
    <div class="event-line">
      <div class="event-meta">{{ .At }} · {{ .FromName }} -> {{ .ToName }} · expires {{ .ExpiryIn }}{{ if .Sealed }} · sealed{{ end }}</div>
      <div><strong>{{ .Subject }}</strong></div>
      <div>{{ .Body }}</div>
    </div>
  {{ else }}<div class="muted">No intercepted missives.</div>{{ end }}
</div>
{{ end }}

{{ define "intel_oob" }}
<div id="intel" hx-swap-oob="innerHTML" class="card">
  {{ template "intel_inner" . }}
</div>
{{ end }}
