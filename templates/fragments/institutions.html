{{ define "institutions_inner" }}
<h3 class="heading-with-icon"><span class="icon icon-tint-violet" style="--icon-src: url('/assets/icons/ffffff/transparent/1x1/delapouite/congress.png');" aria-hidden="true"></span>Institutions</h3>
<div class="muted">Tax {{ .Policies.TaxRatePct }}% 路 Permit {{ if .Policies.PermitRequiredHighRisk }}Required{{ else }}Open{{ end }} 路 Embargo {{ .Policies.SmugglingEmbargoTicks }} ticks</div>
<div class="muted" style="margin-top:4px;">High impact remaining: {{ .HighImpactRemaining }} / {{ .HighImpactCap }}</div>
{{ if .Traveling }}
  <div class="muted" style="margin-top:4px;">Travel in progress: institutional actions are paused.</div>
{{ end }}
{{ if gt .World.WardNetworkTicks 0 }}
  <div class="muted" style="margin-top:4px;">Ward network active: {{ .World.WardNetworkTicks }} ticks remaining.</div>
{{ end }}
<div class="contracts" style="margin-top:8px;">
  {{ range .Seats }}
    <div class="contract">
      <div><strong>{{ .Name }}</strong> <span class="pill">{{ .InstitutionName }}</span></div>
      <div class="meta">
        <span>Holder: {{ .HolderName }}</span>
        {{ if .IsElectionOpen }}<span>Election: {{ .ElectionWindowTicks }} ticks</span>{{ else }}<span>Tenure: {{ .TenureTicksLeft }} ticks</span>{{ end }}
      </div>
      <div class="actions">
        {{ if .CanCampaign }}
          <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML">
            <input type="hidden" name="action" value="campaign_seat">
            <input type="hidden" name="contract_id" value="{{ .ID }}">
            <button type="submit" {{ if $.Traveling }}disabled{{ end }}>Campaign</button>
          </form>
        {{ end }}
        {{ if .CanChallenge }}
          <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML">
            <input type="hidden" name="action" value="challenge_seat">
            <input type="hidden" name="contract_id" value="{{ .ID }}">
            <button class="secondary" type="submit" {{ if $.Traveling }}disabled{{ end }}>Challenge</button>
          </form>
        {{ end }}
        {{ if .CanToggleTaxHigh }}
          <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML"><input type="hidden" name="action" value="set_tax_high"><button class="secondary" type="submit" {{ if $.Traveling }}disabled{{ end }}>Tax 20%</button></form>
        {{ end }}
        {{ if .CanToggleTaxLow }}
          <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML"><input type="hidden" name="action" value="set_tax_low"><button class="secondary" type="submit" {{ if $.Traveling }}disabled{{ end }}>Tax 5%</button></form>
        {{ end }}
        {{ if .CanTogglePermit }}
          <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML"><input type="hidden" name="action" value="toggle_permit"><button class="secondary" type="submit" {{ if $.Traveling }}disabled{{ end }}>{{ if $.Policies.PermitRequiredHighRisk }}Open Permits{{ else }}Require Permits{{ end }}</button></form>
        {{ end }}
        {{ if .CanToggleEmbargo }}
          <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML"><input type="hidden" name="action" value="toggle_embargo"><button class="secondary" type="submit" {{ if $.Traveling }}disabled{{ end }}>{{ if gt $.Policies.SmugglingEmbargoTicks 0 }}Lift Embargo{{ else }}Impose Embargo{{ end }}</button></form>
        {{ end }}
        {{ if .CanIssuePermit }}
          <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML">
            <input type="hidden" name="action" value="issue_permit">
            <select name="target_id" aria-label="Permit recipient" {{ if $.Traveling }}disabled{{ end }}>
              {{ range $.PlayerOptions }}<option value="{{ .ID }}">{{ .Name }}</option>{{ end }}
            </select>
            <button class="secondary" type="submit" {{ if $.Traveling }}disabled{{ end }}>Issue Permit ({{ $.HighImpactRemaining }}/{{ $.HighImpactCap }})</button>
          </form>
        {{ end }}
        {{ if .CanConductInquest }}
          <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML">
            <input type="hidden" name="action" value="conduct_inquest">
            <select name="target_id" aria-label="Inquest target" {{ if $.Traveling }}disabled{{ end }}>
              {{ range $.PlayerOptions }}<option value="{{ .ID }}">{{ .Name }}</option>{{ end }}
            </select>
            <button class="secondary" type="submit" {{ if $.Traveling }}disabled{{ end }}>Conduct Inquest ({{ $.HighImpactRemaining }}/{{ $.HighImpactCap }})</button>
          </form>
        {{ end }}
        {{ if .CanIssueWarrant }}
          <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML">
            <input type="hidden" name="action" value="issue_warrant">
            <select name="target_id" aria-label="Warrant target" {{ if $.Traveling }}disabled{{ end }}>
              {{ range $.PlayerOptions }}<option value="{{ .ID }}">{{ .Name }}</option>{{ end }}
            </select>
            <button class="warn" type="submit" {{ if $.Traveling }}disabled{{ end }}>Issue Warrant ({{ $.HighImpactRemaining }}/{{ $.HighImpactCap }})</button>
          </form>
        {{ end }}
      </div>
    </div>
  {{ end }}
</div>
<div class="muted" style="margin-top:10px;">Active Permits</div>
<div class="contracts" style="margin-top:8px;">
  {{ range .Permits }}
    <div class="contract">
      <div><strong>{{ .PlayerName }}</strong> <span class="pill">Permit</span></div>
      <div class="meta">
        <span>Issued by: {{ .IssuerName }}</span>
        <span>Ticks left: {{ .TicksLeft }}</span>
      </div>
    </div>
  {{ else }}
    <div class="muted">No active permits.</div>
  {{ end }}
</div>
<div class="muted" style="margin-top:10px;">Active Warrants</div>
<div class="contracts" style="margin-top:8px;">
  {{ range .Warrants }}
    <div class="contract">
      <div><strong>{{ .PlayerName }}</strong> <span class="pill">Warrant</span></div>
      <div class="meta">
        <span>Issued by: {{ .IssuerName }}</span>
        <span>Ticks left: {{ .TicksLeft }}</span>
      </div>
    </div>
  {{ else }}
    <div class="muted">No active warrants.</div>
  {{ end }}
</div>
<div class="muted" style="margin-top:10px;">Public Works</div>
<div class="contracts" style="margin-top:8px;">
  {{ range .Projects }}
    <div class="contract">
      <div><strong>{{ .Name }}</strong> <span class="pill">{{ .OwnerName }}</span></div>
      <div class="meta">
        <span>Ticks left: {{ .TicksLeft }}</span>
        <span>{{ .EffectNote }}</span>
      </div>
    </div>
  {{ else }}
    <div class="muted">No public works underway.</div>
  {{ end }}
</div>
<div class="contracts" style="margin-top:8px;">
  {{ range .ProjectOptions }}
    <div class="contract">
      <div><strong>{{ .Name }}</strong></div>
      <div class="meta">
        <span>{{ .Description }}</span>
        <span>Cost: {{ .CostGold }}g{{ if gt .CostGrain 0 }} 路 {{ .CostGrain }} sacks{{ end }} 路 {{ .DurationTicks }} ticks</span>
      </div>
      {{ if .DisabledReason }}
        <div class="muted" style="margin-top:6px;">{{ .DisabledReason }}</div>
      {{ end }}
      <div class="actions">
        <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML">
          <input type="hidden" name="action" value="launch_project">
          <input type="hidden" name="project_type" value="{{ .Type }}">
          <button class="secondary" type="submit" {{ if or .Disabled $.Traveling }}disabled{{ end }}>Fund Project</button>
        </form>
      </div>
    </div>
  {{ end }}
</div>
{{ end }}

{{ define "institutions_oob" }}
<div id="institutions" hx-swap-oob="innerHTML" class="card">
  {{ template "institutions_inner" . }}
</div>
{{ end }}
