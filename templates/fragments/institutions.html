{{ define "institutions_inner" }}
<h3>Institutions</h3>
<div class="muted">Tax {{ .Policies.TaxRatePct }}% 路 Permit {{ if .Policies.PermitRequiredHighRisk }}Required{{ else }}Open{{ end }} 路 Embargo {{ .Policies.SmugglingEmbargoTicks }} ticks</div>
<div class="muted" style="margin-top:4px;">High impact remaining: {{ .HighImpactRemaining }} / {{ .HighImpactCap }}</div>
<div class="contracts" style="margin-top:8px;">
  {{ range .Seats }}
    <div class="contract">
      <div><strong>{{ .Name }}</strong> <span class="pill">{{ .InstitutionName }}</span></div>
      <div class="meta">
        <span>Holder: {{ .HolderName }}</span>
        {{ if .IsElectionOpen }}<span>Election: {{ .ElectionWindowTicks }} ticks</span>{{ else }}<span>Tenure: {{ .TenureTicksLeft }} ticks</span>{{ end }}
      </div>
      <div class="actions">
        {{ if .CanCampaign }}
          <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML">
            <input type="hidden" name="action" value="campaign_seat">
            <input type="hidden" name="contract_id" value="{{ .ID }}">
            <button type="submit">Campaign</button>
          </form>
        {{ end }}
        {{ if .CanChallenge }}
          <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML">
            <input type="hidden" name="action" value="challenge_seat">
            <input type="hidden" name="contract_id" value="{{ .ID }}">
            <button class="secondary" type="submit">Challenge</button>
          </form>
        {{ end }}
        {{ if .CanToggleTaxHigh }}
          <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML"><input type="hidden" name="action" value="set_tax_high"><button class="secondary" type="submit">Tax 20%</button></form>
        {{ end }}
        {{ if .CanToggleTaxLow }}
          <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML"><input type="hidden" name="action" value="set_tax_low"><button class="secondary" type="submit">Tax 5%</button></form>
        {{ end }}
        {{ if .CanTogglePermit }}
          <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML"><input type="hidden" name="action" value="toggle_permit"><button class="secondary" type="submit">{{ if $.Policies.PermitRequiredHighRisk }}Open Permits{{ else }}Require Permits{{ end }}</button></form>
        {{ end }}
        {{ if .CanToggleEmbargo }}
          <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML"><input type="hidden" name="action" value="toggle_embargo"><button class="secondary" type="submit">{{ if gt $.Policies.SmugglingEmbargoTicks 0 }}Lift Embargo{{ else }}Impose Embargo{{ end }}</button></form>
        {{ end }}
      </div>
    </div>
  {{ end }}
</div>
<div class="muted" style="margin-top:10px;">Public Works</div>
<div class="contracts" style="margin-top:8px;">
  {{ range .Projects }}
    <div class="contract">
      <div><strong>{{ .Name }}</strong> <span class="pill">{{ .OwnerName }}</span></div>
      <div class="meta">
        <span>Ticks left: {{ .TicksLeft }}</span>
        <span>{{ .EffectNote }}</span>
      </div>
    </div>
  {{ else }}
    <div class="muted">No public works underway.</div>
  {{ end }}
</div>
<div class="contracts" style="margin-top:8px;">
  {{ range .ProjectOptions }}
    <div class="contract">
      <div><strong>{{ .Name }}</strong></div>
      <div class="meta">
        <span>{{ .Description }}</span>
        <span>Cost: {{ .CostGold }}g{{ if gt .CostGrain 0 }} 路 {{ .CostGrain }} sacks{{ end }} 路 {{ .DurationTicks }} ticks</span>
      </div>
      {{ if .DisabledReason }}
        <div class="muted" style="margin-top:6px;">{{ .DisabledReason }}</div>
      {{ end }}
      <div class="actions">
        <form hx-post="/action" hx-target="#dashboard" hx-swap="innerHTML">
          <input type="hidden" name="action" value="launch_project">
          <input type="hidden" name="project_type" value="{{ .Type }}">
          <button class="secondary" type="submit" {{ if .Disabled }}disabled{{ end }}>Fund Project</button>
        </form>
      </div>
    </div>
  {{ end }}
</div>
{{ end }}

{{ define "institutions_oob" }}
<div id="institutions" hx-swap-oob="innerHTML" class="card">
  {{ template "institutions_inner" . }}
</div>
{{ end }}
