# Black Granary v0.2.0 Plan

## Objective
Deliver the first version where social and political play is mechanically deep enough to produce repeatable "power through leverage" stories, not only contract drama.

## Product Goals
1. Add durable player-to-player leverage loops (obligations, secrets, legitimacy, sanctions).
2. Make information a strategic layer (rumors, evidence, credibility, exposure).
3. Introduce institutions as playable power structures (offices, policies, contests for control).
4. Expand economic gameplay from spot contracts to instruments (credit, permits, taxes, embargoes).
5. Increase agency verbs so players can solve problems through politics, finance, law, and manipulation.

## Non-Goals (v0.2.0)
1. No persistent database; keep reset-on-restart architecture.
2. No full map/travel overhaul.
3. No combat expansion beyond current minimal model.
4. No large content/lore volume; focus on systems that generate stories.
5. No district/location granularity for policy simulation; citywide policies only.

## Scope by System

### 1) Institutions v1
1. Add 3 institution tracks:
   1. `City Authority`
   2. `Merchant League`
   3. `Temple`
2. Add "seats" with powers and limited tenure:
   1. `Harbor Master` (permits, embargo actions)
   2. `Master of Coin` (tax rate, emergency levy)
   3. `High Curate` (legitimacy actions, absolution/hearing)
3. Add seat acquisition mechanics:
   1. Election (rep-weighted, time window)
   2. Appointment (NPC default)
   3. Challenge/Censure action path
4. Surface institution state in UI with current office holders and active policies.

### 2) Information Warfare v1
1. Add `Rumor` objects with fields: claim, target, source, credibility, spread, decay.
2. Add `Evidence` objects: source, strength, topic, expiry.
3. Add actions:
   1. `seed_rumor`
   2. `investigate_target`
   3. `publish_evidence`
   4. `counter_narrative`
4. Add outcomes:
   1. Rep/heat shifts from accepted narratives
   2. Institution triggers (inquiry, sanction, protection)
   3. Contract modifiers based on perceived trust

### 3) Economic Instruments v1
1. Add player ledger and obligations:
   1. `loan_offer`
   2. `loan_accept`
   3. `repay`
   4. `default`
2. Add policy instruments tied to seats:
   1. Global tax rate band
   2. Permit requirements for high-value deliveries
   3. Temporary embargo on contract types
3. Add market consequences:
   1. Price pressure reacts to policy + defaults
   2. Smuggling value increases under embargo/permits
4. Add event visibility so economic actions are legible in world log.

### 4) Agency Verbs Expansion
1. Add high-leverage social verbs:
   1. `bribe_official`
   2. `petition_institution`
   3. `threaten_exposure` (requires evidence)
   4. `broker_deal` (multi-party contract boost)
2. Keep each action tied to explicit costs and risks (gold, heat, rep, cooldown).
3. Ensure at least 3 distinct viable strategies for resolving scarcity crisis:
   1. Administrative (policy)
   2. Economic (trade/credit)
   3. Informational (rumor/evidence campaign)

### 5) Lore-Driven Mechanics v1
1. Add lightweight doctrine tags to factions and seats.
2. Add ritual/legal framing actions:
   1. `invoke_rite` for legitimacy boost or inquiry immunity window
   2. `accuse_heresy` as high-risk narrative weapon
3. Link lore tags to mechanical modifiers (not flavor-only).

## Technical Plan

### Data Model
1. Extend `Store` with:
   1. `Institutions`, `Seats`, `Policies`
   2. `Rumors`, `Evidence`
   3. `Loans`, `Obligations`
2. Add bounded ring buffers/maps with cleanup each tick.
3. Preserve single global mutex model for correctness in v0.2.0.

### Tick Integration
1. Add per-tick processors:
   1. rumor spread/decay
   2. evidence expiry
   3. loan due/default checks
   4. seat tenure and election windows
2. Emit narrative events only on meaningful state transitions.

### HTTP/UI Surface
1. New fragments:
   1. `institutions`
   2. `intel`
   3. `ledger`
2. Extend `/action` with new verbs and validation.
3. Keep htmx OOB update strategy; include new panels in response payload.

### Safety/Abuse Controls
1. Add cooldowns for rumor/evidence actions.
2. Add per-player daily caps on high-impact actions.
3. Add minimum evidence threshold for punitive institution outcomes.

## Delivery Milestones

### M1: Institutions + Seats
1. Implement institution state, seat ownership, policy toggles.
2. Add UI panel and events for policy changes.
3. Ship tests for seat transitions and policy effects.

### M2: Information Warfare
1. Implement rumor/evidence lifecycle and new actions.
2. Connect credibility outcomes to rep/heat and institutions.
3. Ship tests for spread, countering, and false-claim penalties.

### M3: Economic Instruments
1. Implement loans/defaults and policy-linked permits/embargoes.
2. Connect to contract rewards/risks and market pressure.
3. Ship tests for repayment/default and economic shock propagation.

### M4: Balance + Fun Profile Validation
1. Tune numbers and cooldowns using scripted multi-player simulations.
2. Add "today's political situation" summary with key leverage shifts.
3. Finalize release notes and migration/reset notes.

## Acceptance Criteria (Release Gate)
1. At least 5 new player actions produce second-order effects within 3 ticks.
2. At least 2 distinct institution powers can materially change contract outcomes.
3. At least 1 complete "information attack -> institutional response -> economic consequence" chain is reproducible in tests.
4. At least 1 complete "credit/default -> sanction/embargo -> smuggling response" chain is reproducible in tests.
5. In a 30-minute 5-player simulation, at least 3 major event arcs involve direct player-to-player leverage, not only NPC/system pressure.

## Test Strategy
1. Unit tests for state transitions (rumor credibility, loan defaults, seat challenges).
2. Handler tests for action validation, authorization, and OOB fragments.
3. Scenario tests (scripted ticks + action sequences) for political/economic chains.
4. Soak test (5-10 concurrent players) for mutex safety and latency.

## Risks and Mitigations
1. Risk: System complexity reduces legibility.
   1. Mitigation: Add concise "Why this changed" annotations in dashboard and events.
2. Risk: Information warfare becomes spam.
   1. Mitigation: Cooldowns, evidence thresholds, decay, and penalties for failed claims.
3. Risk: Dominant strategy emerges (single best meta).
   1. Mitigation: Asymmetric costs and rotating policy constraints.

## Definition of Done
1. All acceptance criteria met.
2. Test suite green locally (`go test ./...`).
3. Manual multiplayer session validates at least one political and one financial power-transfer story.
4. `VERSION` bumped to `0.2.0` only when release gate passes.
